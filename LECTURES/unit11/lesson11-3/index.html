<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 11.3 - NCHS Cybersecurity</title>
    
    
    <link rel="icon" href="../../../img/logo.png">
    
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRPQMPQQS6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DRPQMPQQS6');
    </script>
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #141b3a;
            --text-primary: #00ff41;
            --text-secondary: #7affa7;
            --text-muted: #4a9960;
            --accent: #ff0844;
            --accent-secondary: #00d4ff;
            --border: #1a3a2a;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-secondary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--text-primary);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 255, 65, 0.2);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-logo img {
            height: 40px;
            width: auto;
        }

        .nav-logo a {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--text-primary);
            text-decoration: none;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
            align-items: center;
        }

        .nav-links > li {
            position: relative;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: 4px;
            display: block;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--text-primary);
            background: rgba(0, 255, 65, 0.1);
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* Dropdown menu */
        .nav-links .dropdown {
            position: relative;
        }

        .nav-links .dropdown > a::after {
            content: ' ‚ñº';
            font-size: 0.7em;
            margin-left: 5px;
        }

        .nav-links .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 4px;
            min-width: 250px;
            box-shadow: 0 8px 30px rgba(0, 255, 65, 0.3);
            z-index: 1000;
            padding: 10px 0;
            margin-top: 5px;
        }

        .nav-links .dropdown:hover .dropdown-content {
            display: block;
        }

        .nav-links .dropdown-content li {
            list-style: none;
        }

        .nav-links .dropdown-content a {
            padding: 10px 20px;
            border-radius: 0;
        }

        .nav-links .dropdown-content .nested {
            padding-left: 0;
        }

        .nav-links .dropdown-content .nested > strong {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .nav-links .dropdown-content .nested > strong:hover {
            background: rgba(0, 255, 65, 0.1);
        }

        .nav-links .dropdown-content .nested > strong::after {
            content: '‚ñº';
            font-size: 0.8em;
            transition: transform 0.3s ease;
            color: var(--text-primary);
        }

        .nav-links .dropdown-content .nested.collapsed > strong::after {
            transform: rotate(-90deg);
        }

        .nav-links .dropdown-content .nested .unit-lessons {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-links .dropdown-content .nested.collapsed .unit-lessons {
            max-height: 0;
        }

        .nav-links .dropdown-content .nested .unit-lessons li {
            padding-left: 20px;
        }

        .nav-links .dropdown-content .nested a {
            padding: 8px 20px;
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .nav-links .dropdown-content .nested a:hover {
            color: var(--text-primary);
            background: rgba(0, 255, 65, 0.05);
        }

        /* Mobile menu toggle */
        .nav-toggle {
            display: none;
            background: none;
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
        }

        /* Search */
        .search-container {
            position: relative;
            margin-left: 20px;
        }

        .search-input {
            padding: 8px 35px 8px 15px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--text-primary);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 2000;
            box-shadow: 0 8px 30px rgba(0, 255, 65, 0.3);
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        .search-result-title {
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .search-result-path {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .search-result-excerpt {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .search-highlight {
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 700;
        }

        .search-no-results {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
        }

        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .search-results::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .search-results::-webkit-scrollbar-thumb {
            background: var(--text-primary);
            border-radius: 4px;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        h1 {
            font-size: 2.5rem;
            text-shadow: 0 0 20px var(--text-primary);
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--text-primary);
            padding-bottom: 15px;
        }

        h2 {
            font-size: 2rem;
            border-left: 4px solid var(--text-primary);
            padding-left: 15px;
        }

        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }

        p {
            margin-bottom: 1.2rem;
            color: var(--text-secondary);
        }

        a {
            color: var(--accent-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        a:hover {
            color: var(--text-primary);
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* Code Blocks */
        code {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
        }

        pre {
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        pre code {
            background: transparent;
            border: none;
            padding: 0;
        }

        /* Lists */
        ul, ol {
            margin-left: 30px;
            margin-bottom: 1.2rem;
        }

        li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        li::marker {
            color: var(--text-primary);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px;
            text-align: left;
            border: 1px solid var(--text-primary);
            font-weight: 700;
        }

        td {
            padding: 12px;
            border: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--text-primary);
            background: var(--bg-secondary);
            padding: 15px 20px;
            margin: 20px 0;
            font-style: italic;
        }

        /* Images */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--text-primary);
            margin: 30px 0;
            opacity: 0.3;
        }

        /* Footer */
        footer {
            background: var(--bg-secondary);
            border-top: 2px solid var(--text-primary);
            padding: 30px;
            margin-top: 60px;
            text-align: center;
            color: var(--text-muted);
        }

        /* Scanline Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 255, 65, 0.02) 51%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Selection */
        ::selection {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-primary);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-toggle {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--bg-secondary);
                flex-direction: column;
                padding: 20px;
                border-bottom: 2px solid var(--text-primary);
            }

            .nav-links.active {
                display: flex;
            }

            h1 {
                font-size: 2rem;
            }

            .container {
                padding: 20px 15px;
            }

            .search-container {
                margin-left: 10px;
            }

            .search-input {
                width: 200px;
            }
        }

        /* Search Box */
        .search-box {
            padding: 10px;
            background: var(--bg-primary);
            border: 1px solid var(--text-primary);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .search-box::placeholder {
            color: var(--text-muted);
        }

        /* Lesson Navigation */
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 60px 0 40px 0;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .lesson-nav-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            background: var(--bg-primary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .lesson-nav-button:hover {
            background: var(--text-primary);
            color: var(--bg-primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.3);
        }

        .lesson-nav-button.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .lesson-nav-button .arrow {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .lesson-nav-info {
            text-align: center;
            color: var(--text-secondary);
        }

        .lesson-nav-info .current-lesson {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .lesson-nav-info .lesson-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .lesson-nav {
                flex-direction: column;
                gap: 20px;
            }

            .lesson-nav-button {
                width: 100%;
                justify-content: center;
            }

            .lesson-nav-info {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="nav-logo">
                
                <img src="../../../img/logo.png" alt="Logo">
                
                <a href="https://mohamed-morsy33.github.io/cybersecuritynchs/">NCHS Cybersecurity</a>
            </div>
            
            <button class="nav-toggle" onclick="toggleMenu()">MENU</button>
            
            <ul class="nav-links" id="navLinks">
                
                <li >
                    
                        <a href="../../.." 
                           >
                            Home
                        </a>
                    
                </li>
                
                <li class="dropdown">
                    
                        <a href="#">Curriculum</a>
                        <ul class="dropdown-content">
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 1</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-1/">Lesson 1.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-2/">Lesson 1.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-3/">Lesson 1.3</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-4/">Lesson 1.4</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-5/">Lesson 1.5</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-6/">Lesson 1.6</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/installation-process/">Linux Installation Process</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 2</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-1/">Lesson 2.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-2/">Lesson 2.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-3/">Lesson 2.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 3</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-1/">Lesson 3.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-2/">Lesson 3.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-3/">Lesson 3.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 4</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit4/lesson4-1/">Lesson 4.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit4/lesson4-2/">Lesson 4.2</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 5</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-1/">Lesson 5.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-2/">Lesson 5.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-3/">Lesson 5.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 6</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-1/">Lesson 6.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-2/">Lesson 6.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-3/">Lesson 6.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 7</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-1/">Lesson 7.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-2/">Lesson 7.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-3/">Lesson 7.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 8</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-1/">Lesson 8.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-2/">Lesson 8.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-3/">Lesson 8.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 9</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit9/lesson9-1/">Lesson 9.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit9/lesson9-2/">Lesson 9.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit9/lesson9-3/">Lesson 9.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 10</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-1/">Lesson 10.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-2/">Lesson 10.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-3/">Lesson 10.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 11</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../lesson11-1/">Lesson 11.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../lesson11-2/">Lesson 11.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="./">Lesson 11.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                        </ul>
                    
                </li>
                
                <li >
                    
                        <a href="../../../test/" 
                           >
                            Terminal
                        </a>
                    
                </li>
                
            </ul>

            <div class="search-container">
                <input type="text" 
                       class="search-input" 
                       id="searchInput" 
                       placeholder="Search lessons..."
                       autocomplete="off">
                <span class="search-icon">üîç</span>
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <h1 id="secure-communication-protocols-and-end-to-end-encryption">Secure Communication Protocols and End-to-End Encryption</h1>
<p>Beyond VPNs and TLS, modern applications need end-to-end encryption, secure messaging, and privacy-preserving technologies. This lesson covers Signal Protocol, encrypted email, secure file transfer, and emerging privacy technologies.</p>
<h2 id="end-to-end-encryption-e2ee">End-to-End Encryption (E2EE)</h2>
<h3 id="what-is-e2ee">What is E2EE?</h3>
<p><strong>End-to-end encryption ensures only sender and recipient can read messages.</strong></p>
<p><strong>Traditional encryption:</strong></p>
<pre><code>Alice ‚Üí [Encrypted] ‚Üí Server [Decrypts, Re-encrypts] ‚Üí Bob
         Server can read messages
</code></pre>
<p><strong>End-to-end encryption:</strong></p>
<pre><code>Alice ‚Üí [Encrypted] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí Bob
         Server cannot read messages
</code></pre>
<p><strong>Properties:</strong>
- Only endpoints have keys
- Server can't decrypt
- Protects against compromised servers
- Protects against government surveillance</p>
<h3 id="perfect-forward-secrecy-pfs">Perfect Forward Secrecy (PFS)</h3>
<p><strong>Ensures past messages stay secure even if long-term keys compromised.</strong></p>
<p><strong>How it works:</strong>
- Generate new ephemeral keys for each session
- Delete keys after use
- Compromise of current key doesn't affect past messages</p>
<p><strong>Without PFS:</strong></p>
<pre><code>If attacker gets private key + has recorded traffic
  ‚Üí Can decrypt all past communications
</code></pre>
<p><strong>With PFS:</strong></p>
<pre><code>If attacker gets private key + has recorded traffic
  ‚Üí Can only decrypt current session
  ‚Üí Past sessions remain secure
</code></pre>
<h2 id="signal-protocol">Signal Protocol</h2>
<h3 id="the-gold-standard-of-e2ee">The Gold Standard of E2EE</h3>
<p><strong>Used by:</strong>
- Signal Messenger
- WhatsApp
- Facebook Messenger (Secret Conversations)
- Google Messages (RCS)
- Skype (Private Conversations)</p>
<p><strong>Security properties:</strong>
- End-to-end encryption
- Perfect forward secrecy
- Post-compromise security (future secrecy)
- Deniability
- Asynchronous messaging</p>
<h3 id="double-ratchet-algorithm">Double Ratchet Algorithm</h3>
<p><strong>Core of Signal Protocol</strong></p>
<p><strong>Two ratchets:</strong></p>
<p><strong>1. Diffie-Hellman Ratchet:</strong>
- New key agreement with each message
- Provides forward secrecy
- Updates shared secrets</p>
<p><strong>2. Symmetric Key Ratchet:</strong>
- Derives new keys from previous keys
- Used between DH ratchet updates
- Fast and efficient</p>
<p><strong>Key hierarchy:</strong></p>
<pre><code>Root Key
   ‚Üì
Chain Keys (sending and receiving)
   ‚Üì
Message Keys (one per message)
</code></pre>
<p><strong>How it works:</strong></p>
<pre><code>Alice                           Bob
------                          -----
Generate DH keypair
Send DH public key  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
                              Receive Alice's DH public key
                              Perform DH key agreement
                              Derive chain keys
                    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  Send encrypted message
Receive message
Derive message key
Decrypt message
Generate new DH keypair
Send encrypted message ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
                              Perform new DH key agreement
                              Derive new chain keys
                              ...
</code></pre>
<p><strong>Each message:</strong>
1. Derives unique message key
2. Deletes key after encryption/decryption
3. Can't be decrypted again</p>
<h3 id="x3dh-extended-triple-diffie-hellman">X3DH (Extended Triple Diffie-Hellman)</h3>
<p><strong>Initial key agreement for asynchronous messaging</strong></p>
<p><strong>Allows:</strong>
- Encrypted messages to offline recipients
- No real-time interaction needed
- Immediate forward secrecy</p>
<p><strong>Keys involved:</strong>
- Identity key (long-term)
- Signed prekey (medium-term)
- One-time prekeys (single-use)
- Ephemeral key (session-specific)</p>
<p><strong>Process:</strong></p>
<pre><code>Bob (offline) publishes to server:
  - Identity public key (IKb)
  - Signed prekey (SPKb)
  - Multiple one-time prekeys (OPKb)

Alice wants to message Bob:
  1. Fetch Bob's keys from server
  2. Generate ephemeral key (EKa)
  3. Perform 3 or 4 DH operations:
     - DH(IKa, SPKb)
     - DH(EKa, IKb)
     - DH(EKa, SPKb)
     - DH(EKa, OPKb)  [if one-time prekey available]
  4. Combine DH results into shared secret
  5. Send initial message with EKa

Bob comes online:
  1. Receives message with Alice's EKa
  2. Performs same DH operations
  3. Derives same shared secret
  4. Decrypts message
  5. Deletes one-time prekey
</code></pre>
<h3 id="implementing-signal-like-encryption">Implementing Signal-like Encryption</h3>
<p><strong>Simple example (not production-ready):</strong></p>
<pre><code class="language-python">from cryptography.hazmat.primitives.asymmetric import x25519
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.hkdf import HKDF
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
import os

class SignalLikeEncryption:
    def __init__(self):
        # Long-term identity key
        self.identity_private = x25519.X25519PrivateKey.generate()
        self.identity_public = self.identity_private.public_key()

        # Current ratchet keys
        self.ratchet_private = None
        self.ratchet_public = None

        # Chain keys
        self.sending_chain_key = None
        self.receiving_chain_key = None

    def kdf(self, input_key_material, salt=None):
        &quot;&quot;&quot;Key derivation function&quot;&quot;&quot;
        if salt is None:
            salt = b'\x00' * 32

        kdf = HKDF(
            algorithm=hashes.SHA256(),
            length=32,
            salt=salt,
            info=b'Signal Protocol'
        )
        return kdf.derive(input_key_material)

    def dh(self, private_key, public_key):
        &quot;&quot;&quot;Diffie-Hellman exchange&quot;&quot;&quot;
        return private_key.exchange(public_key)

    def ratchet_step(self, their_public_key):
        &quot;&quot;&quot;Perform DH ratchet step&quot;&quot;&quot;
        # Generate new ratchet keypair
        self.ratchet_private = x25519.X25519PrivateKey.generate()
        self.ratchet_public = self.ratchet_private.public_key()

        # Perform DH
        dh_output = self.dh(self.ratchet_private, their_public_key)

        # Derive new chain keys
        root_key = self.kdf(dh_output)
        self.sending_chain_key = self.kdf(root_key, b'sending')
        self.receiving_chain_key = self.kdf(root_key, b'receiving')

        return self.ratchet_public

    def encrypt_message(self, plaintext):
        &quot;&quot;&quot;Encrypt a message&quot;&quot;&quot;
        # Derive message key from chain key
        message_key = self.kdf(self.sending_chain_key)

        # Update chain key for next message
        self.sending_chain_key = self.kdf(self.sending_chain_key)

        # Encrypt
        iv = os.urandom(16)
        cipher = Cipher(
            algorithms.AES(message_key),
            modes.CTR(iv)
        )
        encryptor = cipher.encryptor()
        ciphertext = encryptor.update(plaintext.encode()) + encryptor.finalize()

        return iv + ciphertext

    def decrypt_message(self, encrypted_data):
        &quot;&quot;&quot;Decrypt a message&quot;&quot;&quot;
        # Extract IV and ciphertext
        iv = encrypted_data[:16]
        ciphertext = encrypted_data[16:]

        # Derive message key from chain key
        message_key = self.kdf(self.receiving_chain_key)

        # Update chain key for next message
        self.receiving_chain_key = self.kdf(self.receiving_chain_key)

        # Decrypt
        cipher = Cipher(
            algorithms.AES(message_key),
            modes.CTR(iv)
        )
        decryptor = cipher.decryptor()
        plaintext = decryptor.update(ciphertext) + decryptor.finalize()

        return plaintext.decode()

# Usage (simplified)
alice = SignalLikeEncryption()
bob = SignalLikeEncryption()

# Initial key exchange
bob_ratchet_public = bob.ratchet_step(alice.identity_public)
alice.ratchet_step(bob_ratchet_public)

# Alice sends message
encrypted = alice.encrypt_message(&quot;Hello Bob!&quot;)
print(f&quot;Encrypted: {encrypted.hex()}&quot;)

# Bob receives and decrypts
decrypted = bob.decrypt_message(encrypted)
print(f&quot;Decrypted: {decrypted}&quot;)
</code></pre>
<h2 id="encrypted-email">Encrypted Email</h2>
<h3 id="pgpgpg">PGP/GPG</h3>
<p><strong>Pretty Good Privacy - Email encryption standard</strong></p>
<p><strong>Key management:</strong></p>
<pre><code class="language-bash"># Generate key
gpg --full-generate-key

# List keys
gpg --list-keys
gpg --list-secret-keys

# Export public key
gpg --armor --export your@email.com &gt; public_key.asc

# Import someone's public key
gpg --import their_public_key.asc

# Sign someone's key (trust)
gpg --sign-key their@email.com
</code></pre>
<p><strong>Encrypt email:</strong></p>
<pre><code class="language-bash"># Encrypt message
gpg --encrypt --armor --recipient recipient@email.com message.txt

# Encrypt and sign
gpg --encrypt --sign --armor --recipient recipient@email.com message.txt

# Decrypt
gpg --decrypt encrypted_message.txt.asc
</code></pre>
<p><strong>Using with email client:</strong></p>
<p><strong>Thunderbird + Enigmail:</strong>
- Install Enigmail addon
- Generate or import key
- Compose ‚Üí Encrypt message
- Automatic encryption when recipient's key available</p>
<p><strong>Web of Trust:</strong></p>
<pre><code>You sign Alice's key (you trust Alice is Alice)
Alice signs Bob's key (Alice trusts Bob is Bob)
You can trust Bob's key through Alice (transitive trust)
</code></pre>
<h3 id="smime">S/MIME</h3>
<p><strong>Secure/Multipurpose Internet Mail Extensions</strong></p>
<p><strong>Differences from PGP:</strong>
- Uses X.509 certificates
- Requires Certificate Authority
- Better enterprise support
- Native support in email clients
- Hierarchical trust model</p>
<p><strong>Get certificate:</strong>
1. Purchase from CA (or use free from organizations)
2. Generate CSR
3. Submit to CA
4. Receive certificate
5. Install in email client</p>
<p><strong>Outlook S/MIME:</strong>
- File ‚Üí Options ‚Üí Trust Center ‚Üí Email Security
- Import certificate
- "Encrypt contents and attachments"
- "Add digital signature"</p>
<h2 id="secure-file-transfer">Secure File Transfer</h2>
<h3 id="scp-secure-copy-protocol">SCP (Secure Copy Protocol)</h3>
<p><strong>Copy files over SSH:</strong></p>
<pre><code class="language-bash"># Upload file
scp local_file.txt user@remote:/path/

# Download file
scp user@remote:/path/file.txt local_directory/

# Copy directory
scp -r local_directory/ user@remote:/path/

# Specify port
scp -P 2222 file.txt user@remote:/path/

# Preserve file attributes
scp -p file.txt user@remote:/path/
</code></pre>
<h3 id="sftp-ssh-file-transfer-protocol">SFTP (SSH File Transfer Protocol)</h3>
<p><strong>Interactive file transfer:</strong></p>
<pre><code class="language-bash"># Connect
sftp user@remote

# Navigate
pwd                 # Print working directory
lpwd                # Print local working directory
ls                  # List remote files
lls                 # List local files
cd directory        # Change remote directory
lcd directory       # Change local directory

# Transfer
put local_file.txt  # Upload
get remote_file.txt # Download
put -r directory/   # Upload directory
get -r directory/   # Download directory

# Exit
exit
</code></pre>
<h3 id="rsync-over-ssh">rsync over SSH</h3>
<p><strong>Efficient file synchronization:</strong></p>
<pre><code class="language-bash"># Sync directory
rsync -avz -e ssh local_dir/ user@remote:/path/

# Options explained:
# -a: archive mode (preserve permissions, timestamps)
# -v: verbose
# -z: compress during transfer
# -e ssh: use SSH

# Sync with delete (mirror)
rsync -avz --delete -e ssh local_dir/ user@remote:/path/

# Dry run (test without changes)
rsync -avzn -e ssh local_dir/ user@remote:/path/

# Show progress
rsync -avz --progress -e ssh local_dir/ user@remote:/path/

# Exclude files
rsync -avz --exclude='*.log' -e ssh local_dir/ user@remote:/path/
</code></pre>
<h3 id="magic-wormhole">Magic Wormhole</h3>
<p><strong>Simple encrypted file transfer:</strong></p>
<pre><code class="language-bash"># Install
pip install magic-wormhole

# Send file
wormhole send file.txt
# Outputs code: 7-crossword-ventilate

# Receive (on other machine)
wormhole receive 7-crossword-ventilate

# Send directory
wormhole send --code 5-example-code directory/

# The code is used for key exchange
# End-to-end encrypted
# Works through NAT/firewalls
</code></pre>
<h2 id="encrypted-messaging-applications">Encrypted Messaging Applications</h2>
<h3 id="signal">Signal</h3>
<p><strong>Architecture:</strong>
- Open source
- Centralized servers (but can't read messages)
- Phone number as identifier
- Desktop and mobile apps
- Voice and video calls</p>
<p><strong>Security features:</strong>
- End-to-end encryption (Signal Protocol)
- Perfect forward secrecy
- Sealed sender (hide metadata)
- Disappearing messages
- Screen security (screenshot protection)
- Registration lock
- Safety numbers (verify identity)</p>
<h3 id="matrixelement">Matrix/Element</h3>
<p><strong>Architecture:</strong>
- Open source
- Decentralized (federated servers)
- Self-hostable
- Username as identifier
- Voice and video calls</p>
<p><strong>Security features:</strong>
- End-to-end encryption (Olm/Megolm)
- Device verification
- Cross-signing
- Encrypted attachments
- Federated identity</p>
<h3 id="wire">Wire</h3>
<p><strong>Architecture:</strong>
- Open source
- End-to-end encrypted
- Supports teams/business
- No phone number required</p>
<p><strong>Security features:</strong>
- Signal Protocol
- Encrypted audio/video
- Encrypted file sharing
- External audit</p>
<h2 id="privacy-enhancing-technologies">Privacy-Enhancing Technologies</h2>
<h3 id="tor-the-onion-router">Tor (The Onion Router)</h3>
<p><strong>Anonymous communication:</strong></p>
<pre><code class="language-bash"># Install Tor
sudo apt install tor

# Configure as SOCKS proxy
# In /etc/tor/torrc:
SocksPort 9050

# Start Tor
sudo systemctl start tor

# Use with applications
curl --socks5-hostname localhost:9050 https://check.torproject.org/

# Use Tor Browser (recommended)
# Download from torproject.org
</code></pre>
<p><strong>How Tor works:</strong></p>
<pre><code>You ‚Üí Entry node ‚Üí Middle node ‚Üí Exit node ‚Üí Destination

Each hop only knows previous and next hop
Destination doesn't know your IP
You don't know full path
Encrypted in layers (like onion)
</code></pre>
<h3 id="i2p-invisible-internet-project">I2P (Invisible Internet Project)</h3>
<p><strong>Anonymous network layer:</strong></p>
<pre><code class="language-bash"># Install I2P
sudo apt install i2p

# Access web interface
# http://127.0.0.1:7657

# I2P provides:
# - Anonymous hosting
# - Encrypted communication
# - Distributed network
# - Hidden services
</code></pre>
<h3 id="mixnets">Mixnets</h3>
<p><strong>Anonymize metadata through mixing:</strong></p>
<p><strong>Examples:</strong>
- Nym Network
- Katzenpost
- Loopix</p>
<p><strong>How it works:</strong></p>
<pre><code>1. Batch messages from multiple senders
2. Mix (reorder) messages
3. Add delays
4. Forward to next mix node
5. Repeat multiple hops
6. Deliver to recipients

Result: Hard to trace which output came from which input
</code></pre>
<h2 id="zero-knowledge-proofs">Zero-Knowledge Proofs</h2>
<p><strong>Prove you know something without revealing it</strong></p>
<p><strong>Example: Proving age without revealing birthdate</strong></p>
<pre><code class="language-python"># Simplified concept (not real ZKP)
def prove_over_18(birthdate, current_date):
    &quot;&quot;&quot;Prove age &gt; 18 without revealing exact age&quot;&quot;&quot;
    age = current_date.year - birthdate.year

    # Create commitment
    commitment = hash(birthdate + random_salt)

    # Prove age &gt; 18 without revealing birthdate
    proof = {
        'commitment': commitment,
        'is_over_18': age &gt;= 18,
        'verification_data': generate_zkp(age &gt;= 18)
    }

    return proof

# Verifier can confirm age &gt; 18
# But learns nothing else about birthdate
</code></pre>
<p><strong>Real-world applications:</strong>
- Anonymous credentials
- Private voting
- Blockchain privacy (Zcash)
- Private authentication</p>
<h2 id="secure-communication-best-practices">Secure Communication Best Practices</h2>
<h3 id="operational-security">Operational Security</h3>
<p><strong>Communication security:</strong>
- Use E2EE for sensitive conversations
- Verify contacts (safety numbers)
- Enable disappearing messages for sensitive topics
- Be aware of metadata leakage
- Use secure devices</p>
<p><strong>Key management:</strong>
- Generate strong keys
- Backup keys securely
- Rotate keys regularly
- Revoke compromised keys
- Verify key fingerprints</p>
<p><strong>Platform selection:</strong>
- Open source preferred
- Audited by security researchers
- Active maintenance
- Clear threat model
- Strong encryption defaults</p>
<h3 id="threat-modeling">Threat Modeling</h3>
<p><strong>Ask yourself:</strong></p>
<p><strong>What are you protecting?</strong>
- Messages
- Metadata (who talks to whom)
- Files
- Identity</p>
<p><strong>Who are you protecting against?</strong>
- Casual snoopers
- Criminals
- Corporations
- Governments
- Nation states</p>
<p><strong>Choose tools accordingly:</strong>
- Casual privacy: Signal, Wire
- High anonymity: Tor, I2P
- Maximum security: Air-gapped systems</p>
<h2 id="key-takeaways">Key Takeaways</h2>
<p><strong>End-to-end encryption:</strong>
- Only sender and recipient can read
- Server compromise doesn't expose messages
- Signal Protocol is gold standard
- Requires proper key management</p>
<p><strong>Email security:</strong>
- PGP/GPG for decentralized encryption
- S/MIME for enterprise
- Both require key/certificate management
- Metadata still exposed</p>
<p><strong>File transfer:</strong>
- SCP/SFTP for regular use
- rsync for synchronization
- Magic Wormhole for simplicity
- Always verify recipients</p>
<p><strong>Privacy technologies:</strong>
- Tor for anonymity
- I2P for hidden services
- Mixnets for metadata protection
- Zero-knowledge proofs for selective disclosure</p>
<p><strong>Remember:</strong>
- Encryption protects content, not metadata
- Perfect forward secrecy is important
- Verify keys/identities
- Choose tools for your threat model
- Security vs. convenience tradeoff</p>
<p>Secure communication is more than just encryption‚Äîit's about protecting privacy, ensuring authenticity, and defending against diverse threats. Understanding these technologies helps you choose the right tools and use them correctly.</p>
        

        <!-- Lesson Navigation (only show on non-homepage pages) -->
        
        <div class="lesson-nav">
            
            <a href="../lesson11-2/" class="lesson-nav-button">
                <span class="arrow">‚Üê</span>
                <span>Previous: Lesson 11.2</span>
            </a>
            

            <div class="lesson-nav-info">
                <div class="current-lesson">Current Lesson</div>
                <div class="lesson-title">Lesson 11.3</div>
            </div>

            
            <a href="../../../test/" class="lesson-nav-button">
                <span>Next: Terminal</span>
                <span class="arrow">‚Üí</span>
            </a>
            
        </div>
        
    </div>

    <footer>
        <p>NCHS Cybersecurity | Built with MkDocs</p>
        
        <p>Copyright &copy; 2025 Mohamed Morsy</p>
        
    </footer>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    
    <script src="../../../search_index.js"></script>
    
    <script>
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const unitHeaders = document.querySelectorAll('.nav-links .nested > strong');
            
            unitHeaders.forEach(header => {
                header.addEventListener('click', function(e) {
                    e.stopPropagation(); 
                    const parent = this.parentElement;
                    parent.classList.toggle('collapsed');
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchInput || !searchResults) {
                return;
            }
            
            let searchIndex = null;
            let useSimpleSearch = false;
            
            const simpleIndex = [
                
                    
                
                    
                        
                            
                                
                                {
                                    title: "Lesson 1.1",
                                    url: '../../unit1/lesson1-1/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.2",
                                    url: '../../unit1/lesson1-2/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.3",
                                    url: '../../unit1/lesson1-3/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.4",
                                    url: '../../unit1/lesson1-4/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.5",
                                    url: '../../unit1/lesson1-5/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.6",
                                    url: '../../unit1/lesson1-6/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Linux Installation Process",
                                    url: '../../unit1/installation-process/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 2.1",
                                    url: '../../unit2/lesson2-1/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                                {
                                    title: "Lesson 2.2",
                                    url: '../../unit2/lesson2-2/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                                {
                                    title: "Lesson 2.3",
                                    url: '../../unit2/lesson2-3/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 3.1",
                                    url: '../../unit3/lesson3-1/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                                {
                                    title: "Lesson 3.2",
                                    url: '../../unit3/lesson3-2/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                                {
                                    title: "Lesson 3.3",
                                    url: '../../unit3/lesson3-3/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 4.1",
                                    url: '../../unit4/lesson4-1/',
                                    path: 'Curriculum > Unit 4'
                                },
                                
                                {
                                    title: "Lesson 4.2",
                                    url: '../../unit4/lesson4-2/',
                                    path: 'Curriculum > Unit 4'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 5.1",
                                    url: '../../unit5/lesson5-1/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                                {
                                    title: "Lesson 5.2",
                                    url: '../../unit5/lesson5-2/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                                {
                                    title: "Lesson 5.3",
                                    url: '../../unit5/lesson5-3/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 6.1",
                                    url: '../../unit6/lesson6-1/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                                {
                                    title: "Lesson 6.2",
                                    url: '../../unit6/lesson6-2/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                                {
                                    title: "Lesson 6.3",
                                    url: '../../unit6/lesson6-3/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 7.1",
                                    url: '../../unit7/lesson7-1/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                                {
                                    title: "Lesson 7.2",
                                    url: '../../unit7/lesson7-2/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                                {
                                    title: "Lesson 7.3",
                                    url: '../../unit7/lesson7-3/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 8.1",
                                    url: '../../unit8/lesson8-1/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                                {
                                    title: "Lesson 8.2",
                                    url: '../../unit8/lesson8-2/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                                {
                                    title: "Lesson 8.3",
                                    url: '../../unit8/lesson8-3/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 9.1",
                                    url: '../../unit9/lesson9-1/',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                                {
                                    title: "Lesson 9.2",
                                    url: '../../unit9/lesson9-2/',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                                {
                                    title: "Lesson 9.3",
                                    url: '../../unit9/lesson9-3/',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 10.1",
                                    url: '../../unit10/lesson10-1/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                                {
                                    title: "Lesson 10.2",
                                    url: '../../unit10/lesson10-2/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                                {
                                    title: "Lesson 10.3",
                                    url: '../../unit10/lesson10-3/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 11.1",
                                    url: '../lesson11-1/',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                                {
                                    title: "Lesson 11.2",
                                    url: '../lesson11-2/',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                                {
                                    title: "Lesson 11.3",
                                    url: './',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                            
                        
                    
                
                    
                        {
                            title: "Terminal",
                            url: '../../../test/',
                            path: 'Main'
                        },
                    
                
            ];
            
            if (typeof window.searchIndex !== 'undefined') {
                searchIndex = window.searchIndex;
                useSimpleSearch = false;
                console.log('‚úì Using embedded search index:', searchIndex.docs.length, 'documents');
            } else {
                const base_url = document.querySelector('base')?.getAttribute('href') || '/';
                fetch(base_url + 'search_data.js')
                    .then(response => response.text())
                    .then(data => {
                        eval(data);  
                        if (window.searchIndex) {
                            searchIndex = window.searchIndex;
                            useSimpleSearch = false;
                            console.log('‚úì Loaded search index from JS:', searchIndex.docs.length, 'documents');
                        }
                    })
                    .catch(() => {
                        console.log('Using simple title search (full search not available)');
                        useSimpleSearch = true;
                    });
                
                useSimpleSearch = true; 
            }
            
            function performSearch(query) {
                if (!query || query.length < 2) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                if (useSimpleSearch || !searchIndex) {
                    performSimpleSearch(query);
                } else {
                    performFullSearch(query);
                }
            }
            
            function performSimpleSearch(query) {
                const lowerQuery = query.toLowerCase();
                const results = simpleIndex.filter(item => 
                    item.title.toLowerCase().includes(lowerQuery)
                );
                displaySimpleResults(results, query);
            }
            
            function performFullSearch(query) {
                const lowerQuery = query.toLowerCase();
                const queryTerms = lowerQuery.split(/\s+/);
                
                const results = searchIndex.docs
                    .map(doc => {
                        let score = 0;
                        let matchedText = '';
                        
                        if (doc.title && doc.title.toLowerCase().includes(lowerQuery)) {
                            score += 10;
                        }
                        
                        if (doc.text) {
                            const text = doc.text.toLowerCase();
                            queryTerms.forEach(term => {
                                if (term.length < 2) return;
                                const count = (text.match(new RegExp(escapeRegex(term), 'g')) || []).length;
                                score += count;
                                
                                if (count > 0 && !matchedText) {
                                    const index = text.indexOf(term);
                                    const start = Math.max(0, index - 50);
                                    const end = Math.min(text.length, index + term.length + 50);
                                    matchedText = doc.text.substring(start, end);
                                    if (start > 0) matchedText = '...' + matchedText;
                                    if (end < text.length) matchedText = matchedText + '...';
                                }
                            });
                        }
                        
                        return {
                            title: doc.title,
                            location: doc.location,
                            text: matchedText || (doc.text ? doc.text.substring(0, 150) + '...' : ''),
                            score: score
                        };
                    })
                    .filter(result => result.score > 0)
                    .sort((a, b) => b.score - a.score);
                
                displayFullResults(results, query);
            }
            
            function displaySimpleResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
                    searchResults.classList.add('active');
                    return;
                }
                
                const html = results.slice(0, 10).map(result => {
                    const highlightedTitle = highlightText(result.title, query);
                    return `
                        <a href="${result.url}" class="search-result-item">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-path">${escapeHtml(result.path)}</div>
                        </a>
                    `;
                }).join('');
                
                searchResults.innerHTML = html;
                searchResults.classList.add('active');
            }
            
            function displayFullResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
                    searchResults.classList.add('active');
                    return;
                }
                
                const pathname = window.location.pathname;
                let basePath = '/';
                
                const pathParts = pathname.split('/').filter(p => p);
                
                if (pathParts.length > 0 && !pathParts[0].endsWith('.html')) {
                    const firstPart = pathParts[0];
                    if (firstPart !== 'index' && firstPart !== 'search') {
                        basePath = '/' + firstPart + '/';
                    }
                }
                
                console.log('Current pathname:', pathname);
                console.log('Detected base path:', basePath);
                
                const html = results.slice(0, 10).map(result => {
                    const highlightedTitle = highlightText(result.title, query);
                    const highlightedText = highlightText(result.text, query);
                    
                    let path = result.location.replace(/^\//, '').replace(/\.html$/, '').replace(/\//g, ' > ');
                    if (!path) path = 'Home';
                    
                    let url;
                    if (basePath === '/') {
                        url = result.location;
                    } else {
                        const cleanLocation = result.location.startsWith('/') ? result.location.substring(1) : result.location;
                        url = basePath + cleanLocation;
                    }
                    
                    console.log('Result:', result.title, '-> URL:', url);
                    
                    return `
                        <a href="${url}" class="search-result-item">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-path">${escapeHtml(path)}</div>
                            <div class="search-result-excerpt">${highlightedText}</div>
                        </a>
                    `;
                }).join('');
                
                searchResults.innerHTML = html;
                searchResults.classList.add('active');
            }
            
            function highlightText(text, query) {
                if (!text) return '';
                const queryTerms = query.split(/\s+/).filter(t => t.length >= 2);
                let result = escapeHtml(text);
                queryTerms.forEach(term => {
                    const regex = new RegExp('(' + escapeRegex(term) + ')', 'gi');
                    result = result.replace(regex, '<span class="search-highlight">$1</span>');
                });
                return result;
            }
            
            function escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
            
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => performSearch(e.target.value), 300);
            });
            
            searchInput.addEventListener('focus', function(e) {
                if (e.target.value.length >= 2) {
                    performSearch(e.target.value);
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.classList.remove('active');
                }
            });
            
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    searchResults.classList.remove('active');
                    searchInput.blur();
                }
            });
        });

        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('pre code').forEach((block) => {
                block.parentElement.style.position = 'relative';
            });
        });
        
    </script>
</body>
</html>